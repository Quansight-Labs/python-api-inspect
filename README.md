# API Usage Statistics

Currently inspected libraries:

<table>
<tr>
  <th>Library</th>
  <th>Whitelist</th>
  <th>Summary only `.py`</th>
  <th>Summary only `.py` tests</th>
  <th>Summary only `.py` without tests</th>
  <th>Summary only `.ipynb`</th>
</tr>
<tr>
  <td>astropy</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/astropy-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/astropy-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/astropy-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/astropy-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/astropy-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>dask</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/dask-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/dask-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/dask-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/dask-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/dask-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>ipython</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/ipython-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipython-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipython-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipython-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipython-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>ipywidgets</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/ipywidgets-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipywidgets-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipywidgets-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipywidgets-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/ipywidgets-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>matplotlib</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/matplotlib-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/matplotlib-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/matplotlib-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/matplotlib-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/matplotlib-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>numpy</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/numpy-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/numpy-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/numpy-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/numpy-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/numpy-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>pandas</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/pandas-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pandas-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pandas-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pandas-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pandas-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>pyarrow</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/pyarrow-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pyarrow-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pyarrow-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pyarrow-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pyarrow-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>pymapd</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/pymapd-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymapd-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymapd-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymapd-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymapd-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>pymc3</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/pymc3-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymc3-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymc3-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymc3-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pymc3-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>pytorch</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/pytorch-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pytorch-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pytorch-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pytorch-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/pytorch-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>requests</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/requests-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/requests-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/requests-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/requests-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/requests-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>scikit-image</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/scikit-image-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-image-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-image-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-image-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-image-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>scikit-learn</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/scikit-learn-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-learn-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-learn-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-learn-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scikit-learn-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>scipy</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/scipy-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scipy-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scipy-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scipy-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/scipy-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>statsmodels</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/statsmodels-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/statsmodels-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/statsmodels-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/statsmodels-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/statsmodels-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>sympy</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/sympy-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/sympy-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/sympy-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/sympy-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/sympy-summary-notebooks.csv">csv</a></td>
</tr>
<tr>
  <td>tensorflow</td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/whitelist/tensorflow-whitelist.ini">ini</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/tensorflow-summary.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/tensorflow-summary-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/tensorflow-summary-without-tests.csv">csv</a></td>
  <td><a href="https://github.com/costrouc/python-api-inspect/blob/master/data/csv/tensorflow-summary-notebooks.csv">csv</a></td>
</tr>
</table>

# Usage

A whitelist is used to specify repositories that are inspected for a
specific libraries that use a given namespace. A namespace is for
example `numpy.random`. We would then use the whitelist of
repositories to search for the usage of any function in
`numpy.random.*`. The whitelist has the following format.

```ini
[config]
namespaces=numpy.random,scipy

[libraries]
pandas=github/pandas-dev/pandas/master
...
```

There is a script to help generate the libraries/repositories to
search for the usage of a given python namespaces. Thanks to the
awesome work at [libaries.io](https://libraries.io).

```shell
python dependant-packages.py --api-key c0....42 --namespaces=numpy --output data/numpy-whitelist.ini numpy,scipy
```

Notice that we need a [libraries.io api
key](https://libraries.io/api). This step is only needed once to
generate a rough list of repositories to search. You will see that
many whitelists have already been created and they only need to be
edited. The previous command gets a list of all libraries that depend
on `numpy` or `scipy`. The `--namespaces` argument specifies which
namespaces to use with inspect. Finally we use the whitelist to search
for the usage of the namespace. Notice how we use `--exclude-dirs` to
not analyze filenames within a directory named `test`, `tests`, or
`site-packages`.

```shell
python inspect_api.py data/numpy-whitelist.ini --output data/numpy-summary-without-tests.csv --exclude-dirs test,tests,site-packages
```

`inspect_api.py` works by using the `ast.parse` method in the standard
library and analyzes the ast for function names and imports. Much more
is possible with this libraries. Caching is used heavily at each
step. If a file has been previously analyzed it will be parse
instantaneously the second time. So you may cancel the run at any time. Currently it is capable of parsing the following from files.

```python
import numpy
import numpy as np
from numpy import random
from numpy import random as rnd

numpy.array([1, 2])
np.sum(1, 2)
random.random()
rnd.random()
```

# dependant-packages.py

```shell
usage: dependant-packages.py [-h] [--include-dependant-repos] --api-key API_KEY
                             --namespaces NAMESPACES [--output OUTPUT]
                             libraries

positional arguments:
  libraries             libraries to gather dependants for

optional arguments:
  -h, --help            show this help message and exit
  --include-dependant-repos
                        include libraries.io dependant repositories (warning for
                        popular packages this can be huge)
  --api-key API_KEY     api key from libraries.io
  --namespaces NAMESPACES
                        namespaces to look for
  --output OUTPUT       output filename
```

## example usage

```shell
python dependant-packages.py --api-key c0....42 --namespaces=numpy --output data/numpy-whitelist.ini numpy,scipy
```

# inspect_api.py

Inspect API of given libraries and number of times functions called

```shell
usage: inspect_api..py [-h] [--cache-dir CACHE_DIR] [--exclude-dirs EXCLUDE_DIRS]
                       [--include-dirs INCLUDE_DIRS] [--output OUTPUT]
                       whitelist

positional arguments:
  whitelist             whitelist filename

optional arguments:
  -h, --help            show this help message and exit
  --cache-dir CACHE_DIR
                        download cache directory
  --exclude-dirs EXCLUDE_DIRS
                        directories to exclude from statistics
  --include-dirs INCLUDE_DIRS
                        directories to include in statistics
  --output OUTPUT       output filename
```

See `whitelist.ini` for namespaces and libraries that are searched. A
sqlite cache is used to speed up previously inspected files. For
example `namespaces=numpy,scipy.linalg` will record all python
function calls within these namespaces.

## usage

```shell
python inspect.py whitelist.ini
```

# Tests

Tests to demo what `inspect.py` is able to parse from file source. The
"test" is a serious hack and doesn't deserve to be called a test.

```shell
# from root of repository
python tests/test_api_inspect.py
```
